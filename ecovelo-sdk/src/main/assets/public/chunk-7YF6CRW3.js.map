{
  "version": 3,
  "sources": ["src/app/services/api-wrappers/support.service.ts"],
  "sourcesContent": ["import { effect, Injectable, OnInit } from '@angular/core'\nimport { StorageService } from '../utils/storage.service'\nimport {\n  FAQService,\n  RetrieveFaq200ResponseAllOfDataInner,\n  RetrieveProgram200Response,\n} from 'src/api-cyclist'\nimport { environment } from 'src/environments/environment'\nimport { BehaviorSubject } from 'rxjs'\nimport { LanguageService } from '../utils/language.service'\nimport { AccountService } from './account.service'\nexport type faqLoadingState =\n  | {\n      state: 'loading'\n    }\n  | {\n      state: 'success'\n      faq: RetrieveFaq200ResponseAllOfDataInner[]\n    }\n  | {\n      state: 'no_data'\n    }\n  | {\n      state: 'error'\n      error: Error\n    }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class SupportService {\n  faqState = new BehaviorSubject<faqLoadingState>({\n    state: 'loading',\n  })\n  program: RetrieveProgram200Response\n  language: string = 'fr'\n  constructor(\n    private storage: StorageService,\n    private faqService: FAQService,\n    private languageService: LanguageService,\n    private accountService: AccountService\n  ) {\n    this.storage.get('program').then((program) => {\n      this.program = program\n    })\n    effect(() => {\n      this.language = this.languageService.currentLanguage()\n      //Si c'est pas la première fois qu'on arrive sur la page, on reload la faq avec la bonne langue.\n      if (this.faqState.value.state !== 'loading') {\n        this.getFaq()\n      }\n    })\n  }\n\n  getFaq() {\n    this.faqState.next({ state: 'loading' })\n    this.faqService\n      .retrieveFaq({\n        program: environment.program,\n        language: this.language,\n      })\n      .subscribe({\n        next: (res) => {\n          if (res.data) {\n            this.faqState.next({ state: 'success', faq: res.data })\n          } else {\n            this.faqState.next({ state: 'no_data' })\n          }\n        },\n        error: (err) => {\n          this.faqState.next({ state: 'error', error: err })\n        },\n      })\n  }\n\n  /**\n   * Génère un lien mailto pour contacter le support avec les informations du cyclist si connecté\n   * @param message Message à inclure dans le corps de l'email (optionnel)\n   * @returns Le lien mailto complet\n   */\n  generateSupportMailtoLink(message: string = ''): string {\n    if (!this.program?.config?.hotline?.email) {\n      return '#'\n    }\n\n    const email = this.program.config.hotline.email\n    const subject = 'Demande SAV'\n    let body = message\n\n    try {\n      const cyclist = this.accountService.getCurrentCyclist()\n      // Utilisateur connecté\n      body += `%0D%0A%0D%0A-------------------------------------------%0D%0A MERCI DE NE PAS MODIFIER LES INFORMATIONS CI-DESSOUS %0D%0A${\n        cyclist.id\n      }%0D%0A${cyclist.name || ''}%0D%0A${cyclist.phone_number || ''}%0D%0A${\n        this.program?.id || ''\n      }`\n    } catch (error) {\n      // Utilisateur non connecté\n      body += `%0D%0A%0D%0A-------------------------------------------%0D%0A MERCI DE NE PAS MODIFIER LES INFORMATIONS CI-DESSOUS %0D%0A Utilisateur non enregistré`\n    }\n\n    return `mailto:${email}?subject=${subject}&body=${body}`\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AA8BM,IAAO,kBAAP,MAAO,gBAAc;EAMzB,YACU,SACA,YACA,iBACA,gBAA8B;AAH9B,SAAA,UAAA;AACA,SAAA,aAAA;AACA,SAAA,kBAAA;AACA,SAAA,iBAAA;AATV,SAAA,WAAW,IAAI,gBAAiC;MAC9C,OAAO;KACR;AAED,SAAA,WAAmB;AAOjB,SAAK,QAAQ,IAAI,SAAS,EAAE,KAAK,CAAC,YAAW;AAC3C,WAAK,UAAU;IACjB,CAAC;AACD,WAAO,MAAK;AACV,WAAK,WAAW,KAAK,gBAAgB,gBAAe;AAEpD,UAAI,KAAK,SAAS,MAAM,UAAU,WAAW;AAC3C,aAAK,OAAM;MACb;IACF,CAAC;EACH;EAEA,SAAM;AACJ,SAAK,SAAS,KAAK,EAAE,OAAO,UAAS,CAAE;AACvC,SAAK,WACF,YAAY;MACX,SAAS,YAAY;MACrB,UAAU,KAAK;KAChB,EACA,UAAU;MACT,MAAM,CAAC,QAAO;AACZ,YAAI,IAAI,MAAM;AACZ,eAAK,SAAS,KAAK,EAAE,OAAO,WAAW,KAAK,IAAI,KAAI,CAAE;QACxD,OAAO;AACL,eAAK,SAAS,KAAK,EAAE,OAAO,UAAS,CAAE;QACzC;MACF;MACA,OAAO,CAAC,QAAO;AACb,aAAK,SAAS,KAAK,EAAE,OAAO,SAAS,OAAO,IAAG,CAAE;MACnD;KACD;EACL;;;;;;EAOA,0BAA0B,UAAkB,IAAE;AAhFhD;AAiFI,QAAI,GAAC,sBAAK,YAAL,mBAAc,WAAd,mBAAsB,YAAtB,mBAA+B,QAAO;AACzC,aAAO;IACT;AAEA,UAAM,QAAQ,KAAK,QAAQ,OAAO,QAAQ;AAC1C,UAAM,UAAU;AAChB,QAAI,OAAO;AAEX,QAAI;AACF,YAAM,UAAU,KAAK,eAAe,kBAAiB;AAErD,cAAQ,4HACN,QAAQ,EACV,SAAS,QAAQ,QAAQ,EAAE,SAAS,QAAQ,gBAAgB,EAAE,WAC5D,UAAK,YAAL,mBAAc,OAAM,EACtB;IACF,SAAS,OAAO;AAEd,cAAQ;IACV;AAEA,WAAO,UAAU,KAAK,YAAY,OAAO,SAAS,IAAI;EACxD;;;mCAzEW,iBAAc,mBAAA,cAAA,GAAA,mBAAA,UAAA,GAAA,mBAAA,eAAA,GAAA,mBAAA,cAAA,CAAA;AAAA;mFAAd,iBAAc,SAAd,gBAAc,WAAA,YAFb,OAAM,CAAA;AAEd,IAAO,iBAAP;;sEAAO,gBAAc,CAAA;UAH1B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
