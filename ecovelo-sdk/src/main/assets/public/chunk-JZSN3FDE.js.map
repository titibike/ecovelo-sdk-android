{
  "version": 3,
  "sources": ["src/api-cyclist/api/tripsPony.service.ts", "src/app/services/api-wrappers/renting.service.ts"],
  "sourcesContent": ["/**\n * api-cyclist\n *\n *\n *\n * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).\n * https://openapi-generator.tech\n * Do not edit the class manually.\n */\n/* tslint:disable:no-unused-variable member-ordering */\n\nimport { Inject, Injectable, Optional } from '@angular/core'\nimport {\n  HttpClient,\n  HttpHeaders,\n  HttpParams,\n  HttpResponse,\n  HttpEvent,\n  HttpParameterCodec,\n  HttpContext,\n} from '@angular/common/http'\nimport { CustomHttpParameterCodec } from '../encoder'\nimport { Observable } from 'rxjs'\n\n// @ts-ignore\nimport { PauseTripRequest } from '../model/pauseTripRequest'\n// @ts-ignore\nimport { ResumeTripRequest } from '../model/resumeTripRequest'\n\n// @ts-ignore\nimport { BASE_PATH, COLLECTION_FORMATS } from '../variables'\nimport { Configuration } from '../configuration'\nimport { environment } from '../../environments/environment'\n\nexport interface PauseTripRequestParams {\n  /** Object is preferably retrieve through its &#x60;id&#x60; but is also accessible through its &#x60;number&#x60; field. */\n  id: string\n  /** If &#x60;True&#x60; will make the call in Prod. Else will do it in Preprod. */\n  liveMode?: boolean\n  pauseTripRequest?: PauseTripRequest\n}\n\nexport interface ResumeTripRequestParams {\n  /** Object is preferably retrieve through its &#x60;id&#x60; but is also accessible through its &#x60;number&#x60; field. */\n  id: string\n  /** If &#x60;True&#x60; will make the call in Prod. Else will do it in Preprod. */\n  liveMode?: boolean\n  resumeTripRequest?: ResumeTripRequest\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class TripsPonyService {\n  protected basePath = environment.basePath\n  public defaultHeaders = new HttpHeaders()\n  public configuration = new Configuration()\n  public encoder: HttpParameterCodec\n\n  constructor(\n    protected httpClient: HttpClient,\n    @Optional() @Inject(BASE_PATH) basePath: string | string[],\n    @Optional() configuration: Configuration\n  ) {\n    if (configuration) {\n      this.configuration = configuration\n    }\n    if (typeof this.configuration.basePath !== 'string') {\n      const firstBasePath = Array.isArray(basePath) ? basePath[0] : undefined\n      if (firstBasePath != undefined) {\n        basePath = firstBasePath\n      }\n\n      if (typeof basePath !== 'string') {\n        basePath = this.basePath\n      }\n      this.configuration.basePath = basePath\n    }\n    this.encoder = this.configuration.encoder || new CustomHttpParameterCodec()\n  }\n\n  // @ts-ignore\n  private addToHttpParams(\n    httpParams: HttpParams,\n    value: any,\n    key?: string\n  ): HttpParams {\n    if (typeof value === 'object' && value instanceof Date === false) {\n      httpParams = this.addToHttpParamsRecursive(httpParams, value)\n    } else {\n      httpParams = this.addToHttpParamsRecursive(httpParams, value, key)\n    }\n    return httpParams\n  }\n\n  private addToHttpParamsRecursive(\n    httpParams: HttpParams,\n    value?: any,\n    key?: string\n  ): HttpParams {\n    if (value == null) {\n      return httpParams\n    }\n\n    if (typeof value === 'object') {\n      if (Array.isArray(value)) {\n        ;(value as any[]).forEach(\n          (elem) =>\n            (httpParams = this.addToHttpParamsRecursive(httpParams, elem, key))\n        )\n      } else if (value instanceof Date) {\n        if (key != null) {\n          httpParams = httpParams.append(\n            key,\n            (value as Date).toISOString().substring(0, 10)\n          )\n        } else {\n          throw Error('key may not be null if value is Date')\n        }\n      } else {\n        Object.keys(value).forEach(\n          (k) =>\n            (httpParams = this.addToHttpParamsRecursive(\n              httpParams,\n              value[k],\n              key != null ? `${key}.${k}` : k\n            ))\n        )\n      }\n    } else if (key != null) {\n      httpParams = httpParams.append(key, value)\n    } else {\n      throw Error('key may not be null if value is not object or array')\n    }\n    return httpParams\n  }\n\n  /**\n   * Pause a trip\n   * @param requestParameters\n   * @param observe set whether or not to return the data Observable as the body, response or events. defaults to returning the body.\n   * @param reportProgress flag to report request and response progress.\n   */\n  public pauseTrip(\n    requestParameters?: PauseTripRequestParams,\n    observe?: 'body',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<any>\n  public pauseTrip(\n    requestParameters?: PauseTripRequestParams,\n    observe?: 'response',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<HttpResponse<any>>\n  public pauseTrip(\n    requestParameters?: PauseTripRequestParams,\n    observe?: 'events',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<HttpEvent<any>>\n  public pauseTrip(\n    requestParameters?: PauseTripRequestParams,\n    observe: any = 'body',\n    reportProgress: boolean = false,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<any> {\n    const id = requestParameters?.id\n    if (id === null || id === undefined) {\n      throw new Error(\n        'Required parameter id was null or undefined when calling pauseTrip.'\n      )\n    }\n    const liveMode = requestParameters?.liveMode\n    const pauseTripRequest = requestParameters?.pauseTripRequest\n\n    let localVarHeaders = this.defaultHeaders\n    if (liveMode !== undefined && liveMode !== null) {\n      localVarHeaders = localVarHeaders.set('Live-Mode', String(liveMode))\n    }\n\n    let localVarHttpHeaderAcceptSelected: string | undefined =\n      options && options.httpHeaderAccept\n    if (localVarHttpHeaderAcceptSelected === undefined) {\n      // to determine the Accept header\n      const httpHeaderAccepts: string[] = []\n      localVarHttpHeaderAcceptSelected =\n        this.configuration.selectHeaderAccept(httpHeaderAccepts)\n    }\n    if (localVarHttpHeaderAcceptSelected !== undefined) {\n      localVarHeaders = localVarHeaders.set(\n        'Accept',\n        localVarHttpHeaderAcceptSelected\n      )\n    }\n\n    let localVarHttpContext: HttpContext | undefined =\n      options && options.context\n    if (localVarHttpContext === undefined) {\n      localVarHttpContext = new HttpContext()\n    }\n\n    let localVarTransferCache: boolean | undefined =\n      options && options.transferCache\n    if (localVarTransferCache === undefined) {\n      localVarTransferCache = true\n    }\n\n    // to determine the Content-Type header\n    const consumes: string[] = ['application/json']\n    const httpContentTypeSelected: string | undefined =\n      this.configuration.selectHeaderContentType(consumes)\n    if (httpContentTypeSelected !== undefined) {\n      localVarHeaders = localVarHeaders.set(\n        'Content-Type',\n        httpContentTypeSelected\n      )\n    }\n\n    let responseType_: 'text' | 'json' | 'blob' = 'json'\n    if (localVarHttpHeaderAcceptSelected) {\n      if (localVarHttpHeaderAcceptSelected.startsWith('text')) {\n        responseType_ = 'text'\n      } else if (\n        this.configuration.isJsonMime(localVarHttpHeaderAcceptSelected)\n      ) {\n        responseType_ = 'json'\n      } else {\n        responseType_ = 'blob'\n      }\n    }\n\n    let localVarPath = `/pony/trips/${this.configuration.encodeParam({\n      name: 'id',\n      value: id,\n      in: 'path',\n      style: 'simple',\n      explode: false,\n      dataType: 'string',\n      dataFormat: undefined,\n    })}/pause`\n    return this.httpClient.request<any>(\n      'post',\n      `${this.configuration.basePath}${localVarPath}`,\n      {\n        context: localVarHttpContext,\n        body: pauseTripRequest,\n        responseType: <any>responseType_,\n        withCredentials: this.configuration.withCredentials,\n        headers: localVarHeaders,\n        observe: observe,\n        transferCache: localVarTransferCache,\n        reportProgress: reportProgress,\n      }\n    )\n  }\n\n  /**\n   * Resume a trip\n   * @param requestParameters\n   * @param observe set whether or not to return the data Observable as the body, response or events. defaults to returning the body.\n   * @param reportProgress flag to report request and response progress.\n   */\n  public resumeTrip(\n    requestParameters?: ResumeTripRequestParams,\n    observe?: 'body',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<any>\n  public resumeTrip(\n    requestParameters?: ResumeTripRequestParams,\n    observe?: 'response',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<HttpResponse<any>>\n  public resumeTrip(\n    requestParameters?: ResumeTripRequestParams,\n    observe?: 'events',\n    reportProgress?: boolean,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<HttpEvent<any>>\n  public resumeTrip(\n    requestParameters?: ResumeTripRequestParams,\n    observe: any = 'body',\n    reportProgress: boolean = false,\n    options?: {\n      httpHeaderAccept?: undefined\n      context?: HttpContext\n      transferCache?: boolean\n    }\n  ): Observable<any> {\n    const id = requestParameters?.id\n    if (id === null || id === undefined) {\n      throw new Error(\n        'Required parameter id was null or undefined when calling resumeTrip.'\n      )\n    }\n    const liveMode = requestParameters?.liveMode\n    const resumeTripRequest = requestParameters?.resumeTripRequest\n\n    let localVarHeaders = this.defaultHeaders\n    if (liveMode !== undefined && liveMode !== null) {\n      localVarHeaders = localVarHeaders.set('Live-Mode', String(liveMode))\n    }\n\n    let localVarHttpHeaderAcceptSelected: string | undefined =\n      options && options.httpHeaderAccept\n    if (localVarHttpHeaderAcceptSelected === undefined) {\n      // to determine the Accept header\n      const httpHeaderAccepts: string[] = []\n      localVarHttpHeaderAcceptSelected =\n        this.configuration.selectHeaderAccept(httpHeaderAccepts)\n    }\n    if (localVarHttpHeaderAcceptSelected !== undefined) {\n      localVarHeaders = localVarHeaders.set(\n        'Accept',\n        localVarHttpHeaderAcceptSelected\n      )\n    }\n\n    let localVarHttpContext: HttpContext | undefined =\n      options && options.context\n    if (localVarHttpContext === undefined) {\n      localVarHttpContext = new HttpContext()\n    }\n\n    let localVarTransferCache: boolean | undefined =\n      options && options.transferCache\n    if (localVarTransferCache === undefined) {\n      localVarTransferCache = true\n    }\n\n    // to determine the Content-Type header\n    const consumes: string[] = ['application/json']\n    const httpContentTypeSelected: string | undefined =\n      this.configuration.selectHeaderContentType(consumes)\n    if (httpContentTypeSelected !== undefined) {\n      localVarHeaders = localVarHeaders.set(\n        'Content-Type',\n        httpContentTypeSelected\n      )\n    }\n\n    let responseType_: 'text' | 'json' | 'blob' = 'json'\n    if (localVarHttpHeaderAcceptSelected) {\n      if (localVarHttpHeaderAcceptSelected.startsWith('text')) {\n        responseType_ = 'text'\n      } else if (\n        this.configuration.isJsonMime(localVarHttpHeaderAcceptSelected)\n      ) {\n        responseType_ = 'json'\n      } else {\n        responseType_ = 'blob'\n      }\n    }\n\n    let localVarPath = `/pony/trips/${this.configuration.encodeParam({\n      name: 'id',\n      value: id,\n      in: 'path',\n      style: 'simple',\n      explode: false,\n      dataType: 'string',\n      dataFormat: undefined,\n    })}/resume`\n    return this.httpClient.request<any>(\n      'post',\n      `${this.configuration.basePath}${localVarPath}`,\n      {\n        context: localVarHttpContext,\n        body: resumeTripRequest,\n        responseType: <any>responseType_,\n        withCredentials: this.configuration.withCredentials,\n        headers: localVarHeaders,\n        observe: observe,\n        transferCache: localVarTransferCache,\n        reportProgress: reportProgress,\n      }\n    )\n  }\n}\n", "import { Injectable, effect } from '@angular/core'\nimport { Capacitor } from '@capacitor/core'\nimport { TranslateService } from '@ngx-translate/core'\nimport { BehaviorSubject, forkJoin, firstValueFrom } from 'rxjs'\nimport {\n  ListTrip200ResponseAllOfDataInner,\n  ListVehicule200ResponseAllOfDataInner,\n  TripsService,\n} from 'src/api-cyclist'\n\n// Type personnalisé pour forcer vehicule en tant qu'any\ntype TripWithAnyVehicule = Omit<\n  ListTrip200ResponseAllOfDataInner,\n  'vehicule'\n> & {\n  vehicule?: any\n}\nimport { environment } from 'src/environments/environment'\nimport { Router } from '@angular/router'\nimport {\n  LoadingController,\n  ToastController,\n  AlertController,\n} from '@ionic/angular/standalone'\nimport {\n  GeolocationService,\n  GeolocationState,\n} from '../utils/geolocation.service'\nimport { TerminationRequestsService } from 'src/api-cyclist'\nimport { AuthService } from '../external/auth.service'\nimport { ToastService, ToastType } from '../utils/toast.service'\nimport { StorageService } from '../utils/storage.service'\nimport { FcmService } from '../external/fcm.service'\nimport { AccountService } from './account.service'\nimport { AppState, AppstateService } from '../internal/appstate.service'\nimport { StationWrapperService } from './stations.service'\nimport { PushNotifications } from '@capacitor/push-notifications'\nimport { TripsPonyService } from 'src/api-cyclist/api/tripsPony.service'\nimport { ErrorHandlerService } from '../utils/error-handler.service'\n\nexport type rentingState =\n  | { state: 'loading' }\n  | {\n      state: 'trips'\n      trips: TripWithAnyVehicule[]\n      tripsCompleted: TripWithAnyVehicule[]\n    }\n  | { state: 'noData' }\n\ninterface StoredRecommendation {\n  tripId: string\n  timestamp: number\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class RentingService {\n  rentingState = new BehaviorSubject<rentingState>({ state: 'loading' })\n  geolocState: GeolocationState\n  private readonly RECOMMENDATION_TTL = 24 * 60 * 60 * 1000 // 24 heures en millisecondes\n  private recommendations$ = new BehaviorSubject<Map<string, number>>(new Map())\n  appState: AppState\n\n  constructor(\n    private translate: TranslateService,\n    private loadingController: LoadingController,\n    private toastController: ToastController,\n    private tripsService: TripsService,\n    private router: Router,\n    private alertController: AlertController,\n    private geolocationService: GeolocationService,\n    private terminationRequestsService: TerminationRequestsService,\n    private authService: AuthService,\n    private toastService: ToastService,\n    private storageService: StorageService,\n    private fcmService: FcmService,\n    private appService: AppstateService,\n    private stationWrapperService: StationWrapperService,\n    private tripsPonyService: TripsPonyService,\n    private accountService: AccountService,\n    private errorHandler: ErrorHandlerService\n  ) {\n    effect(() => {\n      if (this.authService.authState().state === 'SignedOut') {\n        this.rentingState.next({ state: 'noData' })\n      }\n    })\n    this.appService.appState.subscribe((state) => {\n      this.appState = state\n    })\n    this.geolocationService.geolocationState.subscribe((state) => {\n      this.geolocState = state\n    })\n    this.getCurrentTrips()\n    this.initializeRecommendations()\n  }\n\n  private async initializeRecommendations() {\n    const stored = await this.storageService.get('user-recommendations')\n    if (stored) {\n      const recommendations = new Map<string, number>()\n      const currentTime = Date.now()\n\n      // Filtrer les recommandations expirées\n      ;(stored as StoredRecommendation[])\n        .filter((rec) => currentTime - rec.timestamp < this.RECOMMENDATION_TTL)\n        .forEach((rec) => recommendations.set(rec.tripId, rec.timestamp))\n\n      this.recommendations$.next(recommendations)\n\n      // Si des recommandations ont été filtrées, mettre à jour le storage\n      if (stored.length !== recommendations.size) {\n        await this.saveRecommendations(recommendations)\n      }\n    }\n  }\n\n  private async saveRecommendations(recommendations: Map<string, number>) {\n    const storedFormat = Array.from(recommendations.entries()).map(\n      ([tripId, timestamp]) => ({\n        tripId,\n        timestamp,\n      })\n    )\n    await this.storageService.set('user-recommendations', storedFormat)\n  }\n\n  hasRecommended(tripId: string): boolean {\n    const recommendations = this.recommendations$.value\n    const timestamp = recommendations.get(tripId)\n    if (!timestamp) return false\n    return Date.now() - timestamp < this.RECOMMENDATION_TTL\n  }\n\n  async startRenting(\n    vehicle: ListVehicule200ResponseAllOfDataInner,\n    checkLocation: boolean = true,\n    autoUnlock: boolean = false,\n    showLoader: boolean = true,\n    skipRedirect: boolean = false\n  ): Promise<ListTrip200ResponseAllOfDataInner | void> {\n    await this.fcmService.checkPermission()\n    if (checkLocation) {\n      if (\n        this.geolocState.state === 'live_position' ||\n        this.geolocState.state === 'unique_position'\n      ) {\n        const canRent = await this.isInRangeForRenting(\n          vehicle,\n          this.geolocState.position.coords\n        )\n        if (!canRent) {\n          return\n        }\n      }\n    }\n    let loading: any = null\n    if (showLoader) {\n      loading = await this.loadingController.create({\n        message: this.translate.instant('generic.loading'),\n      })\n      await loading.present()\n    }\n    return new Promise((resolve, reject) => {\n      this.tripsService\n        .createTrip({\n          program: environment.program,\n          body: {\n            vehicule: vehicle.id!,\n            origin: Capacitor.isNativePlatform() ? 'mobile' : 'web',\n            auto_unlock: autoUnlock,\n          },\n        })\n        .subscribe({\n          next: async (trip) => {\n            this.getCurrentTrips()\n            await this.stationWrapperService.refreshStations(true)\n            if (loading) await loading.dismiss()\n\n            if (skipRedirect) {\n              // Retourner le trip sans rediriger\n              resolve(trip)\n            } else {\n              // Rediriger vers la page appropriée selon le type de déverrouillage\n              this.router.navigate(['/trips/congrats'], {\n                state: { trip },\n              })\n              resolve(undefined)\n            }\n          },\n          error: async (err) => {\n            if (loading) await loading.dismiss()\n\n            // Only show toast error if not auto-unlock (to avoid duplicate errors)\n            if (!autoUnlock) {\n              const error = await this.toastController.create({\n                message:\n                  err.error.message.split('|')[1]?.trim() || err.error.message,\n                duration: 3000,\n                color: 'danger',\n              })\n              await error.present()\n            }\n\n            reject(err)\n          },\n        })\n    })\n  }\n\n  async pauseTrip(tripId: string): Promise<boolean> {\n    // Show confirmation dialog first\n    const confirmAlert = await this.alertController.create({\n      header: this.translate.instant('renting.alerts.pause_trip'),\n      message: this.translate.instant('renting.alerts.pause_trip_confirmation'),\n      buttons: [\n        {\n          text: this.translate.instant('generic.cancel'),\n          role: 'cancel',\n          handler: () => false,\n        },\n        {\n          text: this.translate.instant('renting.actions.pause'),\n          role: 'confirm',\n          handler: () => true,\n        },\n      ],\n    })\n\n    await confirmAlert.present()\n    const result = await confirmAlert.onDidDismiss()\n\n    if (result.role !== 'confirm') {\n      return false\n    }\n\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('generic.loading'),\n    })\n    await loading.present()\n\n    try {\n      await firstValueFrom(\n        this.tripsPonyService.pauseTrip({\n          id: tripId,\n          liveMode: environment.production,\n          pauseTripRequest: {\n            cyclist: this.accountService.getCurrentCyclist().id!,\n          },\n        })\n      )\n\n      // Wait 2.5 seconds for the backend to update the status\n      await new Promise((resolve) => setTimeout(resolve, 2500))\n\n      await loading.dismiss()\n      this.getCurrentTrips()\n\n      return true\n    } catch (err: any) {\n      await loading.dismiss()\n      this.errorHandler.handleError(err)\n      return false\n    }\n  }\n\n  async isInRangeForRenting(\n    vehicle: ListVehicule200ResponseAllOfDataInner,\n    userCoords?: any\n  ): Promise<boolean> {\n    let distance\n    if (!userCoords || !vehicle.position) {\n      distance = null\n    } else {\n      distance = this.geolocationService.calculateDistance(vehicle.position, {\n        latitude: userCoords.latitude,\n        longitude: userCoords.longitude,\n      })\n    }\n    if (distance === null) {\n      const alert = await this.alertController.create({\n        header: this.translate.instant('renting.alerts.attention'),\n        message: this.translate.instant('renting.alerts.position_unknown'),\n        buttons: [\n          {\n            text: this.translate.instant('generic.cancel'),\n            role: 'cancel',\n            handler: () => false,\n          },\n          {\n            text: this.translate.instant('renting.actions.start'),\n            role: 'confirm',\n            handler: () => true,\n          },\n        ],\n      })\n      await alert.present()\n      const result = await alert.onDidDismiss()\n      return result.role === 'confirm'\n    }\n    if (distance && distance > 100) {\n      const alert = await this.alertController.create({\n        header: this.translate.instant('renting.alerts.attention'),\n        message: this.translate.instant('renting.alerts.vehicle_far', {\n          distance,\n        }),\n        buttons: [\n          {\n            text: this.translate.instant('generic.cancel'),\n            role: 'cancel',\n            handler: () => false,\n          },\n          {\n            text: this.translate.instant('renting.actions.start'),\n            role: 'confirm',\n            handler: () => true,\n          },\n        ],\n      })\n      await alert.present()\n      const result = await alert.onDidDismiss()\n      return result.role === 'confirm'\n    } else {\n      return true\n    }\n  }\n\n  getCurrentTrips() {\n    if (this.authService.authState().state === 'SignedOut') {\n      this.rentingState.next({ state: 'noData' })\n      return\n    } else {\n      this.rentingState.next({ state: 'loading' })\n      forkJoin({\n        renting: this.tripsService.listTrip({\n          program: environment.program,\n          expand: ['vehicule'],\n          statusIn: ['renting,pitstop,terminating,termination_requested'],\n        }),\n        completed: this.tripsService.listTrip({\n          program: environment.program,\n          expand: ['vehicule'],\n          statusIn: ['completed'],\n          endTimestampGte: Math.floor(new Date().getTime() / 1000) - 20 * 60, // 20 minutes\n        }),\n      }).subscribe(({ renting, completed }) => {\n        const uniqueTrips = [\n          ...new Set([...(renting.data || []), ...(completed.data || [])]),\n        ]\n        if (uniqueTrips.length === 0) {\n          this.rentingState.next({ state: 'noData' })\n        } else if (uniqueTrips.length >= 1) {\n          this.rentingState.next({\n            state: 'trips',\n            trips: renting.data || [],\n            tripsCompleted: completed.data || [],\n          })\n        }\n        if (completed.data?.length > 0) {\n          this.accountService.loadCyclist()\n        }\n      })\n    }\n  }\n\n  getState(): rentingState {\n    return this.rentingState.getValue()\n  }\n  async endTripWithCode(tripId: string, endCode: string) {\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('renting.loading.end_trip_request'),\n    })\n    await loading.present()\n\n    try {\n      await firstValueFrom(\n        this.terminationRequestsService.markTripForTermination({\n          program: environment.program,\n          liveMode: environment.production,\n          id: tripId,\n          body: { end_code: endCode },\n        })\n      )\n      await loading.dismiss()\n\n      const successToast = await this.toastController.create({\n        message: this.translate.instant('renting.success.end_trip_request'),\n        duration: 2000,\n        color: 'success',\n      })\n      await successToast.present()\n      this.getCurrentTrips()\n      return true\n    } catch (err: any) {\n      await loading.dismiss()\n      throw err\n    }\n  }\n\n  async resumeTrip(tripId: string): Promise<boolean> {\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('renting.loading.resume_trip'),\n    })\n    await loading.present()\n\n    try {\n      await firstValueFrom(\n        this.tripsPonyService.resumeTrip({\n          id: tripId,\n          liveMode: environment.production,\n          resumeTripRequest: {\n            cyclist: this.accountService.getCurrentCyclist().id!,\n          },\n        })\n      )\n\n      // Wait 2.5 seconds for the backend to update the status\n      await new Promise((resolve) => setTimeout(resolve, 2500))\n\n      await loading.dismiss()\n      this.getCurrentTrips()\n\n      return true\n    } catch (err: any) {\n      await loading.dismiss()\n      this.errorHandler.handleError(err)\n      return false\n    }\n  }\n\n  async endTripWithPhoto(\n    tripId: string,\n    photoUrl: string,\n    positionData: { latitude?: string; longitude?: string } = {}\n  ) {\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('renting.loading.end_trip'),\n    })\n    await loading.present()\n\n    try {\n      await firstValueFrom(\n        this.terminationRequestsService.markTripForTermination({\n          program: environment.program,\n          liveMode: environment.production,\n          id: tripId,\n          body: {\n            photo: photoUrl,\n            ...positionData,\n          },\n        })\n      )\n      await loading.dismiss()\n\n      const successToast = await this.toastController.create({\n        message: this.translate.instant('renting.success.end_trip_request'),\n        duration: 2000,\n        color: 'success',\n      })\n      await successToast.present()\n      this.getCurrentTrips()\n      return true\n    } catch (err: any) {\n      await loading.dismiss()\n      this.errorHandler.handleError(err)\n      throw err\n    }\n  }\n\n  getUserTrips() {\n    return this.tripsService.listTrip({\n      program: environment.program,\n      limit: 100,\n    })\n  }\n\n  hasActiveTripOverThreeHours(t?: ListTrip200ResponseAllOfDataInner): boolean {\n    if (this.rentingState.value.state === 'trips') {\n      const currentTime = Math.floor(Date.now() / 1000)\n      if (t) {\n        const duration = currentTime - t.start_timestamp!\n\n        return (\n          (t.status === 'renting' || t.status === 'pitstop') &&\n          duration > 10800 &&\n          duration < 86400\n        )\n      } else {\n        return this.rentingState.value.trips.some((trip) => {\n          const duration = currentTime - trip.start_timestamp!\n          return (\n            (trip.status === 'renting' || trip.status === 'pitstop') &&\n            duration > 10800 &&\n            duration < 86400\n          )\n        })\n      }\n    }\n    return false\n  }\n\n  hasActiveTripOver24Hours(t?: ListTrip200ResponseAllOfDataInner): boolean {\n    if (this.rentingState.value.state === 'trips') {\n      const currentTime = Math.floor(Date.now() / 1000)\n      if (t) {\n        const duration = currentTime - t.start_timestamp!\n        return (\n          (t.status === 'renting' || t.status === 'pitstop') && duration > 86400\n        )\n      } else {\n        return this.rentingState.value.trips.some((trip) => {\n          const duration = currentTime - trip.start_timestamp!\n          return (\n            (trip.status === 'renting' || trip.status === 'pitstop') &&\n            duration > 86400\n          )\n        })\n      }\n    }\n    return false\n  }\n\n  async recommendVehicule(tripID: string) {\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('recommandation.loading'),\n    })\n    await loading.present()\n\n    try {\n      const recommendation = await firstValueFrom(\n        this.tripsService.recommendVehicule({\n          program: environment.program,\n          id: tripID,\n        })\n      )\n\n      // Sauvegarder la recommandation avec un timestamp\n      const current = this.recommendations$.value\n      current.set(tripID, Date.now())\n      this.recommendations$.next(current)\n      await this.saveRecommendations(current)\n      await this.router.navigate(['/recommandation-congrats'])\n      return recommendation\n    } catch (err: any) {\n      this.errorHandler.handleError(err)\n      throw err\n    } finally {\n      await loading.dismiss()\n    }\n  }\n\n  // Méthode utilitaire pour nettoyer manuellement les recommandations expirées\n  async cleanExpiredRecommendations() {\n    const current = this.recommendations$.value\n    const currentTime = Date.now()\n    let hasChanges = false\n\n    for (const [tripId, timestamp] of current.entries()) {\n      if (currentTime - timestamp >= this.RECOMMENDATION_TTL) {\n        current.delete(tripId)\n        hasChanges = true\n      }\n    }\n\n    if (hasChanges) {\n      this.recommendations$.next(current)\n      await this.saveRecommendations(current)\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
