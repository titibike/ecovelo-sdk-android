{
  "version": 3,
  "sources": ["src/app/services/api-wrappers/wallet.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core'\nimport { BehaviorSubject } from 'rxjs'\nimport { environment } from 'src/environments/environment'\nimport { RemisesService, TransactionsDeSoldeService } from 'src/api-cyclist'\nimport { ListBalanceTransaction200ResponseAllOfDataInner } from 'src/api-cyclist'\nimport { LoadingController } from '@ionic/angular/standalone'\nimport { ToastService, ToastType } from '../utils/toast.service'\nimport { AccountService, cyclistState } from './account.service'\nimport { TranslateService } from '@ngx-translate/core'\n\nexport type walletTransactionsState =\n  | { state: 'loading' }\n  | { state: 'no_data' }\n  | {\n      state: 'success'\n      transactions: ListBalanceTransaction200ResponseAllOfDataInner[]\n    }\n  | { state: 'error'; error: Error }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class WalletService {\n  walletState = new BehaviorSubject<walletTransactionsState>({\n    state: 'loading',\n  })\n  cyclistState: cyclistState\n\n  constructor(\n    private transactionService: TransactionsDeSoldeService,\n    private remiseService: RemisesService,\n    private loadingController: LoadingController,\n    private toastService: ToastService,\n    private accountService: AccountService,\n    private translate: TranslateService\n  ) {}\n\n  async getTransactions() {\n    this.walletState.next({ state: 'loading' })\n    this.transactionService\n      .listBalanceTransaction({\n        program: environment.program,\n        liveMode: environment.production,\n        limit: 100,\n      })\n      .subscribe({\n        next: async (response) => {\n          if (!response?.data || response.data.length === 0) {\n            this.walletState.next({\n              state: 'no_data',\n            })\n            return\n          }\n\n          this.walletState.next({\n            state: 'success',\n            transactions: response.data,\n          })\n        },\n        error: async (error) => {\n          console.error('Error fetching transactions:', error)\n          this.walletState.next({\n            state: 'error',\n            error,\n          })\n        },\n      })\n  }\n\n  async applyCodePromo(code: string): Promise<void> {\n    if (!code.trim()) {\n      this.toastService.createWithJustMessage(\n        this.translate.instant('promo.errors.empty_code'),\n        ToastType.Warning\n      )\n      return\n    }\n\n    const loading = await this.loadingController.create({\n      message: this.translate.instant('promo.loading.applying'),\n      spinner: 'circular',\n    })\n    await loading.present()\n    const cyclist = this.accountService.cyclistState()\n    if (cyclist.state !== 'unknown' && cyclist.state !== 'error') {\n      this.remiseService\n        .createRemise({\n          program: environment.program,\n          createRemiseRequest: {\n            cyclist: cyclist.cyclist.id!,\n            reduction: code,\n          },\n        })\n        .subscribe({\n          next: async () => {\n            await loading.dismiss()\n            this.toastService.createWithJustMessage(\n              this.translate.instant('promo.success.applied'),\n              ToastType.Success\n            )\n            this.walletState.next({ state: 'loading' })\n          },\n          error: async (error) => {\n            console.error('Error applying promo code:', error)\n            await loading.dismiss()\n            this.toastService.createWithJustMessage(\n              this.translate.instant('promo.errors.invalid'),\n              ToastType.Error\n            )\n          },\n        })\n    }\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;AAsBM,IAAO,iBAAP,MAAO,eAAa;EAMxB,YACU,oBACA,eACA,mBACA,cACA,gBACA,WAA2B;AAL3B,SAAA,qBAAA;AACA,SAAA,gBAAA;AACA,SAAA,oBAAA;AACA,SAAA,eAAA;AACA,SAAA,iBAAA;AACA,SAAA,YAAA;AAXV,SAAA,cAAc,IAAI,gBAAyC;MACzD,OAAO;KACR;EAUE;EAEG,kBAAe;;AACnB,WAAK,YAAY,KAAK,EAAE,OAAO,UAAS,CAAE;AAC1C,WAAK,mBACF,uBAAuB;QACtB,SAAS,YAAY;QACrB,UAAU,YAAY;QACtB,OAAO;OACR,EACA,UAAU;QACT,MAAM,CAAO,aAAY;AACvB,cAAI,EAAC,qCAAU,SAAQ,SAAS,KAAK,WAAW,GAAG;AACjD,iBAAK,YAAY,KAAK;cACpB,OAAO;aACR;AACD;UACF;AAEA,eAAK,YAAY,KAAK;YACpB,OAAO;YACP,cAAc,SAAS;WACxB;QACH;QACA,OAAO,CAAO,UAAS;AACrB,kBAAQ,MAAM,gCAAgC,KAAK;AACnD,eAAK,YAAY,KAAK;YACpB,OAAO;YACP;WACD;QACH;OACD;IACL;;EAEM,eAAe,MAAY;;AAC/B,UAAI,CAAC,KAAK,KAAI,GAAI;AAChB,aAAK,aAAa,sBAChB,KAAK,UAAU,QAAQ,yBAAyB,GAChD,UAAU,OAAO;AAEnB;MACF;AAEA,YAAM,UAAU,MAAM,KAAK,kBAAkB,OAAO;QAClD,SAAS,KAAK,UAAU,QAAQ,wBAAwB;QACxD,SAAS;OACV;AACD,YAAM,QAAQ,QAAO;AACrB,YAAM,UAAU,KAAK,eAAe,aAAY;AAChD,UAAI,QAAQ,UAAU,aAAa,QAAQ,UAAU,SAAS;AAC5D,aAAK,cACF,aAAa;UACZ,SAAS,YAAY;UACrB,qBAAqB;YACnB,SAAS,QAAQ,QAAQ;YACzB,WAAW;;SAEd,EACA,UAAU;UACT,MAAM,MAAW;AACf,kBAAM,QAAQ,QAAO;AACrB,iBAAK,aAAa,sBAChB,KAAK,UAAU,QAAQ,uBAAuB,GAC9C,UAAU,OAAO;AAEnB,iBAAK,YAAY,KAAK,EAAE,OAAO,UAAS,CAAE;UAC5C;UACA,OAAO,CAAO,UAAS;AACrB,oBAAQ,MAAM,8BAA8B,KAAK;AACjD,kBAAM,QAAQ,QAAO;AACrB,iBAAK,aAAa,sBAChB,KAAK,UAAU,QAAQ,sBAAsB,GAC7C,UAAU,KAAK;UAEnB;SACD;MACL;IACF;;;;mCA1FW,gBAAa,mBAAA,0BAAA,GAAA,mBAAA,cAAA,GAAA,mBAAA,iBAAA,GAAA,mBAAA,YAAA,GAAA,mBAAA,cAAA,GAAA,mBAAA,gBAAA,CAAA;AAAA;kFAAb,gBAAa,SAAb,eAAa,WAAA,YAFZ,OAAM,CAAA;AAEd,IAAO,gBAAP;;sEAAO,eAAa,CAAA;UAHzB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
