{
  "version": 3,
  "sources": ["src/app/services/api-wrappers/search.service.ts", "src/app/components/searchbar/searchbar.component.ts", "src/app/components/searchbar/searchbar.component.html"],
  "sourcesContent": ["import { Injectable } from '@angular/core'\nimport { BehaviorSubject, Observable, of } from 'rxjs'\nimport { map, catchError } from 'rxjs/operators'\nimport {\n  SearchService,\n  Search200Response,\n  ListStation200ResponseAllOfDataInner,\n  ListVehicule200ResponseAllOfDataInner,\n} from 'src/api-cyclist'\nimport { environment } from 'src/environments/environment'\n\nexport interface SearchResults {\n  stations: ListStation200ResponseAllOfDataInner[]\n  vehicules: ListVehicule200ResponseAllOfDataInner[]\n}\n\nexport type SearchState =\n  | { state: 'idle' }\n  | { state: 'loading' }\n  | {\n      state: 'success'\n      results: SearchResults\n    }\n  | {\n      state: 'no_results'\n    }\n  | {\n      state: 'error'\n      error: Error\n    }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class SearchWrapperService {\n  searchState: BehaviorSubject<SearchState> = new BehaviorSubject<SearchState>({\n    state: 'idle',\n  })\n\n  constructor(private searchService: SearchService) {}\n\n  search(query: string) {\n    if (!query.trim()) {\n      this.searchState.next({ state: 'idle' })\n      return\n    }\n\n    this.searchState.next({ state: 'loading' })\n    this.searchService\n      .search({\n        program: environment.program,\n        query: query,\n      })\n      .subscribe({\n        next: (response: Search200Response) => {\n          const filteredStations = response.stations?.filter(\n            (station) => station.status === 'open'\n          )\n          const filteredVehicules = response.vehicules?.filter(\n            (vehicule) => vehicule.status === 'service'\n          )\n          if (\n            filteredStations &&\n            filteredStations.length > 0 &&\n            filteredVehicules &&\n            filteredVehicules.length > 0\n          ) {\n            this.searchState.next({\n              state: 'success',\n              results: {\n                stations: filteredStations,\n                vehicules: filteredVehicules,\n              },\n            })\n          } else if (filteredStations && filteredStations.length > 0) {\n            this.searchState.next({\n              state: 'success',\n              results: {\n                stations: filteredStations,\n                vehicules: [],\n              },\n            })\n          } else if (filteredVehicules && filteredVehicules.length > 0) {\n            this.searchState.next({\n              state: 'success',\n              results: {\n                stations: [],\n                vehicules: filteredVehicules,\n              },\n            })\n          } else {\n            this.searchState.next({\n              state: 'no_results',\n            })\n          }\n        },\n        error: (error) => {\n          this.searchState.next({ state: 'error', error })\n        },\n      })\n  }\n\n  searchAsync(query: string): Observable<SearchResults> {\n    if (!query.trim()) {\n      return of({\n        stations: [],\n        vehicules: [],\n      })\n    }\n\n    return this.searchService\n      .search({\n        program: environment.program,\n        query: query,\n      })\n      .pipe(\n        map((response: Search200Response) => ({\n          stations: response.stations || [],\n          vehicules: response.vehicules || [],\n        })),\n        catchError((error) => {\n          console.error('Search error:', error)\n          return of({\n            stations: [],\n            vehicules: [],\n          })\n        })\n      )\n  }\n}\n", "import {\n  Component,\n  effect,\n  OnInit,\n  AfterViewInit,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  EventEmitter,\n} from '@angular/core'\nimport {\n  IonButton,\n  IonIcon,\n  IonInput,\n  Platform,\n} from '@ionic/angular/standalone'\nimport { CommonModule } from '@angular/common'\nimport { FormsModule } from '@angular/forms'\nimport { addIcons } from 'ionicons'\nimport {\n  heart,\n  person,\n  arrowBack,\n  close,\n  searchOutline,\n  arrowBackOutline,\n} from 'ionicons/icons'\nimport { TranslateModule } from '@ngx-translate/core'\nimport { StationWrapperService } from 'src/app/services/api-wrappers/stations.service'\nimport { NavController } from '@ionic/angular'\nimport { Router, RouterLink } from '@angular/router'\nimport { ToastService, ToastType } from 'src/app/services/utils/toast.service'\nimport { AuthService, AuthState } from 'src/app/services/external/auth.service'\nimport { SearchState } from 'src/app/services/api-wrappers/search.service'\n\nexport type SearchBarState = { state: 'idle' } | { state: 'searching' }\n\n@Component({\n  selector: 'app-searchbar',\n  templateUrl: './searchbar.component.html',\n  styleUrls: ['./searchbar.component.scss'],\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonInput,\n    IonButton,\n    IonIcon,\n    TranslateModule,\n    RouterLink,\n  ],\n})\nexport class SearchbarComponent implements OnInit, AfterViewInit {\n  authState: AuthState\n  isAndroid: boolean = false\n  searchBarState: SearchBarState = {\n    state: 'idle',\n  }\n  @Input() state: SearchState = {\n    state: 'idle',\n  }\n  @Output() stateChange = new EventEmitter<void>()\n  @Output() searchQuery = new EventEmitter<string>()\n  @ViewChild('searchInput') searchInput?: IonInput\n  constructor(\n    private stationWrapperService: StationWrapperService,\n    private navCtrl: NavController,\n    private authService: AuthService,\n    private toastService: ToastService,\n    public router: Router,\n    private platform: Platform,\n    private elementRef: ElementRef\n  ) {\n    addIcons({ searchOutline, heart, person, arrowBack, close })\n    effect(() => {\n      this.authState = this.authService.authState()\n    })\n  }\n\n  ngOnInit() {\n    this.isAndroid = this.platform.is('android')\n    if (this.isAndroid) {\n      this.handleAndroidSafeArea()\n    }\n  }\n\n  ngAfterViewInit() {\n    // Auto-focus when on search page\n    if (this.router.url === '/search-page') {\n      setTimeout(() => {\n        if (this.searchInput) {\n          this.searchInput.setFocus()\n        }\n      }, 300)\n    }\n  }\n\n  private handleAndroidSafeArea() {\n    // Ajoute la classe spécifique Android si nécessaire\n    const searchbarElement =\n      this.elementRef.nativeElement.querySelector('.custom-searchbar')\n    if (searchbarElement) {\n      // Vérifie si la safe area fonctionne correctement\n      const safeAreaTop = getComputedStyle(\n        document.documentElement\n      ).getPropertyValue('--ion-safe-area-top')\n\n      if (!safeAreaTop || safeAreaTop === '0px' || safeAreaTop === 'unset') {\n        // Safe area ne fonctionne pas, applique la classe de fallback\n        searchbarElement.classList.add('android-safe-area')\n      }\n    }\n  }\n\n  async onFocus(event: any) {\n    if (this.router.url === '/map') {\n      this.navCtrl.navigateForward('/search-page', { animated: false })\n    } else if (this.router.url === '/search-page') {\n      // Already on search page, do nothing\n    } else {\n      event.target.blur()\n    }\n  }\n\n  onInput(event: any) {\n    const query = event.target.value\n\n    if (!query || query.trim() === '') {\n      this.searchBarState = { state: 'idle' }\n    } else {\n      this.searchBarState = { state: 'searching' }\n    }\n\n    // Émettre la query pour que la page puisse faire sa propre recherche\n    this.searchQuery.emit(query)\n  }\n\n  onFavoriteClick() {\n    if (this.authState.state === 'SignedIn') {\n      this.stationWrapperService.setStationState('favorites-stations')\n    } else {\n      this.toastService.createWithJustMessage(\n        'Vous devez être connecté pour accéder à vos favoris',\n        ToastType.Info\n      )\n      this.navCtrl.navigateForward('/account', { animated: false })\n    }\n  }\n\n  onBackClick() {\n    this.searchBarState = { state: 'idle' }\n    this.navCtrl.navigateBack('/map', { animated: false })\n    this.stateChange.emit()\n  }\n\n  clearInput() {\n    if (this.searchInput) {\n      this.searchInput.value = ''\n      this.searchBarState = { state: 'idle' }\n      this.searchQuery.emit('')\n      // Re-focus the input after clearing\n      setTimeout(() => {\n        if (this.searchInput) {\n          this.searchInput.setFocus()\n        }\n      }, 100)\n    }\n  }\n}\n", "<div class=\"custom-searchbar\" [ngClass]=\"{ focused: state.state !== 'idle' }\">\n  <!-- Show arrow-back when not idle, search icon when idle -->\n  <ion-icon\n    *ngIf=\"state.state === 'idle'\"\n    name=\"search-outline\"\n    size=\"large\"\n  ></ion-icon>\n\n  <ion-icon\n    *ngIf=\"state.state !== 'idle'\"\n    style=\"cursor: pointer\"\n    (click)=\"onBackClick()\"\n    name=\"arrow-back\"\n    size=\"large\"\n  ></ion-icon>\n  <ion-input\n    #searchInput\n    [placeholder]=\"'searchbar.placeholder' | translate\"\n    [debounce]=\"500\"\n    (ionFocus)=\"onFocus($event)\"\n    (ionInput)=\"onInput($event)\"\n  />\n  <ion-button\n    fill=\"clear\"\n    slot=\"end\"\n    color=\"danger\"\n    (click)=\"onFavoriteClick()\"\n    *ngIf=\"state.state === 'idle'\"\n  >\n    <ion-icon slot=\"icon-only\" name=\"heart\"></ion-icon>\n  </ion-button>\n\n  <!-- Clear button when typing on search page -->\n  <ion-button\n    *ngIf=\"searchBarState.state === 'searching'\"\n    fill=\"clear\"\n    slot=\"end\"\n    (click)=\"clearInput()\"\n  >\n    <ion-icon slot=\"icon-only\" name=\"close\"></ion-icon>\n  </ion-button>\n\n  <!-- Account button only on map page -->\n  <ion-button\n    *ngIf=\"searchBarState.state === 'idle' && router.url !== '/search-page'\"\n    slot=\"end\"\n    shape=\"round\"\n    color=\"dark\"\n    [routerLink]=\"'/account'\"\n    class=\"ecl-btn--badge\"\n  >\n    <ion-icon slot=\"icon-only\" name=\"person\"></ion-icon>\n  </ion-button>\n</div>\n"],
  "mappings": "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",
  "names": []
}
