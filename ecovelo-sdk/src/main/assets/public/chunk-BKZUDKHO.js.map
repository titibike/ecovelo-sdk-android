{
  "version": 3,
  "sources": ["src/app/services/api-wrappers/nfc.service.ts"],
  "sourcesContent": ["import { effect, Injectable } from '@angular/core'\nimport { BehaviorSubject, forkJoin } from 'rxjs'\nimport {\n  ListPass200Response,\n  ListPass200ResponseAllOfDataInner,\n  PassesService,\n} from 'src/api-cyclist'\nimport { environment } from 'src/environments/environment'\nimport { AuthService } from '../external/auth.service'\n\nexport type NfcState =\n  | {\n      state: 'loading'\n    }\n  | {\n      state: 'loaded'\n      passes: ListPass200Response\n    }\n  | {\n      state: 'noData'\n    }\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class NfcService {\n  nfcState: BehaviorSubject<NfcState> = new BehaviorSubject<NfcState>({\n    state: 'loading',\n  })\n\n  constructor(\n    private passesService: PassesService,\n    private authService: AuthService\n  ) {\n    effect(() => {\n      if (\n        this.authService.authState().state === 'SignedIn' &&\n        this.nfcState.value.state === 'loading'\n      ) {\n        this.getPasses()\n      } else if (this.authService.authState().state === 'SignedOut') {\n        this.resetState()\n      }\n    })\n  }\n\n  async getPasses() {\n    this.nfcState.next({ state: 'loading' })\n    this.passesService\n      .listPass({\n        program: environment.program,\n      })\n      .subscribe((passes) => {\n        if (passes.data) {\n          if (passes.data!.length === 0) {\n            this.nfcState.next({ state: 'noData' })\n          } else {\n            this.nfcState.next({ state: 'loaded', passes })\n          }\n        }\n      })\n  }\n\n  async associatePass(pass: string, model: string) {\n    return new Promise<ListPass200ResponseAllOfDataInner>((resolve, reject) => {\n      this.passesService\n        .associatePass({\n          program: environment.program,\n          associatePassRequest: {\n            model,\n            uid: pass,\n          },\n        })\n        .subscribe(\n          (pass) => {\n            resolve(pass)\n          },\n          (error) => {\n            reject(error)\n          }\n        )\n    })\n  }\n\n  async disassociatePass(pass: string) {\n    return new Promise<ListPass200ResponseAllOfDataInner>((resolve, reject) => {\n      this.passesService\n        .disassociatePass({\n          program: environment.program,\n          id: pass,\n        })\n        .subscribe(\n          (pass) => {\n            resolve(pass)\n          },\n          (error) => {\n            reject(error)\n          }\n        )\n    })\n  }\n\n  resetState() {\n    this.nfcState.next({ state: 'loading' })\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;AAyBM,IAAO,cAAP,MAAO,YAAU;EAKrB,YACU,eACA,aAAwB;AADxB,SAAA,gBAAA;AACA,SAAA,cAAA;AANV,SAAA,WAAsC,IAAI,gBAA0B;MAClE,OAAO;KACR;AAMC,WAAO,MAAK;AACV,UACE,KAAK,YAAY,UAAS,EAAG,UAAU,cACvC,KAAK,SAAS,MAAM,UAAU,WAC9B;AACA,aAAK,UAAS;MAChB,WAAW,KAAK,YAAY,UAAS,EAAG,UAAU,aAAa;AAC7D,aAAK,WAAU;MACjB;IACF,CAAC;EACH;EAEM,YAAS;;AACb,WAAK,SAAS,KAAK,EAAE,OAAO,UAAS,CAAE;AACvC,WAAK,cACF,SAAS;QACR,SAAS,YAAY;OACtB,EACA,UAAU,CAAC,WAAU;AACpB,YAAI,OAAO,MAAM;AACf,cAAI,OAAO,KAAM,WAAW,GAAG;AAC7B,iBAAK,SAAS,KAAK,EAAE,OAAO,SAAQ,CAAE;UACxC,OAAO;AACL,iBAAK,SAAS,KAAK,EAAE,OAAO,UAAU,OAAM,CAAE;UAChD;QACF;MACF,CAAC;IACL;;EAEM,cAAc,MAAc,OAAa;;AAC7C,aAAO,IAAI,QAA2C,CAAC,SAAS,WAAU;AACxE,aAAK,cACF,cAAc;UACb,SAAS,YAAY;UACrB,sBAAsB;YACpB;YACA,KAAK;;SAER,EACA,UACC,CAACA,UAAQ;AACP,kBAAQA,KAAI;QACd,GACA,CAAC,UAAS;AACR,iBAAO,KAAK;QACd,CAAC;MAEP,CAAC;IACH;;EAEM,iBAAiB,MAAY;;AACjC,aAAO,IAAI,QAA2C,CAAC,SAAS,WAAU;AACxE,aAAK,cACF,iBAAiB;UAChB,SAAS,YAAY;UACrB,IAAI;SACL,EACA,UACC,CAACA,UAAQ;AACP,kBAAQA,KAAI;QACd,GACA,CAAC,UAAS;AACR,iBAAO,KAAK;QACd,CAAC;MAEP,CAAC;IACH;;EAEA,aAAU;AACR,SAAK,SAAS,KAAK,EAAE,OAAO,UAAS,CAAE;EACzC;;;mCA/EW,aAAU,mBAAA,aAAA,GAAA,mBAAA,WAAA,CAAA;AAAA;+EAAV,aAAU,SAAV,YAAU,WAAA,YAFT,OAAM,CAAA;AAEd,IAAO,aAAP;;sEAAO,YAAU,CAAA;UAHtB;WAAW;MACV,YAAY;KACb;;;",
  "names": ["pass"]
}
