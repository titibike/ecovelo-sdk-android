{
  "version": 3,
  "sources": ["src/app/components/document-uploader/document-uploader.component.ts", "src/app/components/document-uploader/document-uploader.component.html"],
  "sourcesContent": ["import { Component, Input, Output, EventEmitter } from '@angular/core'\nimport { TranslateModule, TranslateService } from '@ngx-translate/core'\nimport {\n  IonList,\n  IonItem,\n  IonLabel,\n  IonImg,\n  IonButton,\n  IonIcon,\n  IonRow,\n  IonCol,\n  IonThumbnail,\n  IonActionSheet,\n  ToastController,\n} from '@ionic/angular/standalone'\nimport { CommonModule } from '@angular/common'\nimport { FormsModule } from '@angular/forms'\nimport {\n  cameraOutline,\n  documentOutline,\n  trashOutline,\n  cloudUploadOutline,\n} from 'ionicons/icons'\nimport { addIcons } from 'ionicons'\nimport { MediaService } from 'src/app/services/utils/media.service'\n\nexport interface DocumentImage {\n  front_image?: string\n  back_image?: string\n}\n\nexport enum DocumentSide {\n  FRONT = 'front',\n  BACK = 'back',\n}\n\nexport enum UIState {\n  OPEN = 'open',\n  CLOSED = 'closed',\n}\n\nexport enum LoadingState {\n  LOADING = 'loading',\n  IDLE = 'idle',\n}\n\n@Component({\n  selector: 'app-document-uploader',\n  templateUrl: './document-uploader.component.html',\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonList,\n    IonItem,\n    IonLabel,\n    IonImg,\n    IonButton,\n    IonIcon,\n    IonThumbnail,\n    IonRow,\n    IonCol,\n    IonActionSheet,\n    TranslateModule,\n  ],\n})\nexport class DocumentUploaderComponent {\n  @Input() documentName: string = ''\n  @Input() documentImages: DocumentImage = {}\n  @Input() documentStatus?: string\n  @Output() documentUpdate = new EventEmitter<DocumentImage>()\n  @Output() documentDelete = new EventEmitter<DocumentSide>()\n\n  // Expose enums to template\n  DocumentSide = DocumentSide\n  UIState = UIState\n  LoadingState = LoadingState\n  actionSheetState: UIState = UIState.CLOSED\n  currentSide: DocumentSide | null = null\n  uploadState: LoadingState = LoadingState.IDLE\n\n  public actionSheetButtons = [\n    {\n      text: 'Camera',\n      icon: 'camera',\n      handler: () => this.handleCamera(),\n    },\n    {\n      text: 'Gallery',\n      icon: 'document',\n      handler: () => this.handleGallery(),\n    },\n    {\n      text: 'Cancel',\n      role: 'cancel',\n      data: {\n        action: 'cancel',\n      },\n    },\n  ]\n\n  constructor(\n    private mediaService: MediaService,\n    private translate: TranslateService,\n    private toastCtrl: ToastController\n  ) {\n    addIcons({\n      camera: cameraOutline,\n      document: documentOutline,\n      trash: trashOutline,\n      'cloud-upload': cloudUploadOutline,\n    })\n  }\n\n  openActionSheet(side: DocumentSide) {\n    this.currentSide = side\n    this.actionSheetState = UIState.OPEN\n  }\n\n  isDeleteDisabled(): boolean {\n    return this.uploadState === LoadingState.LOADING\n  }\n\n  async handleCamera() {\n    if (!this.currentSide) return\n    this.uploadState = LoadingState.LOADING\n    const { blob } = await this.mediaService.captureAndProcessPhoto()\n    if (!blob) {\n      throw new Error('No image captured')\n    }\n    const uploadedUrl = await this.mediaService.uploadMedia(blob)\n    if (!uploadedUrl) {\n      throw new Error('Failed to upload image')\n    }\n    await this.updateDocumentImage(uploadedUrl).then(() => {\n      this.uploadState = LoadingState.IDLE\n    })\n  }\n\n  async handleGallery() {\n    if (!this.currentSide) return\n    this.uploadState = LoadingState.LOADING\n    const { blob } = await this.mediaService.selectAndProcessFile()\n    if (!blob) {\n      throw new Error('No file selected')\n    }\n    const uploadedUrl = await this.mediaService.uploadMedia(blob)\n    if (!uploadedUrl) {\n      throw new Error('Failed to upload file')\n    }\n    await this.updateDocumentImage(uploadedUrl).then(() => {\n      this.uploadState = LoadingState.IDLE\n    })\n  }\n\n  private async updateDocumentImage(url: string) {\n    if (!this.currentSide) return\n\n    const updatedImages = { ...this.documentImages }\n    if (this.currentSide === DocumentSide.FRONT) {\n      updatedImages.front_image = url\n    } else {\n      updatedImages.back_image = url\n    }\n\n    this.documentUpdate.emit(updatedImages)\n  }\n\n  async removeDocument(side: DocumentSide) {\n    const updatedImages = { ...this.documentImages }\n    if (side === DocumentSide.FRONT) {\n      updatedImages.front_image = undefined\n    } else {\n      updatedImages.back_image = undefined\n    }\n\n    this.documentUpdate.emit(updatedImages)\n\n    // Emit delete event to parent component for backend deletion\n    this.documentDelete.emit(side)\n  }\n\n  getDocumentDisplayName(): string {\n    // Check if it's a known KYC document type\n    const kycDocumentKey = `documents.kyc.${this.documentName}`\n    const kycDocumentName = this.translate.instant(kycDocumentKey)\n\n    // If translation exists and is different from the key, use it\n    if (kycDocumentName !== kycDocumentKey) {\n      return kycDocumentName\n    }\n\n    // Otherwise, use a generic display format\n    return this.documentName\n      .split('_')\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ')\n  }\n}\n", "<ion-list [inset]=\"true\" mode=\"ios\">\n  <ion-item color=\"grey\">\n    <ion-label>\n      <strong>{{ getDocumentDisplayName() }}</strong>\n    </ion-label>\n  </ion-item>\n  <!-- Front side -->\n  <ion-item color=\"grey\">\n    <ion-thumbnail slot=\"start\">\n      <ion-img\n        [src]=\"\n          documentImages.front_image ||\n          'https://ionicframework.com/docs/img/demos/thumbnail.svg'\n        \"\n        [alt]=\"'documents.front_side' | translate\"\n      ></ion-img>\n    </ion-thumbnail>\n    <ion-label>\n      <ion-row class=\"ion-align-items-center\">\n        <ion-col>\n          <span>{{ 'documents.front_side' | translate }}</span>\n        </ion-col>\n        <ion-col size=\"auto\" class=\"button-container\">\n          <ion-button\n            [style.visibility]=\"\n              documentImages.front_image ? 'visible' : 'hidden'\n            \"\n            (click)=\"removeDocument(DocumentSide.FRONT)\"\n            color=\"danger\"\n            fill=\"clear\"\n            shape=\"round\"\n            size=\"large\"\n            [disabled]=\"isDeleteDisabled()\"\n          >\n            <ion-icon name=\"trash\" slot=\"icon-only\"></ion-icon>\n          </ion-button>\n          <ion-button\n            (click)=\"openActionSheet(DocumentSide.FRONT)\"\n            shape=\"round\"\n            size=\"large\"\n          >\n            <ion-icon name=\"cloud-upload\" slot=\"icon-only\"></ion-icon>\n          </ion-button>\n        </ion-col>\n      </ion-row>\n    </ion-label>\n  </ion-item>\n\n  <!-- Back side -->\n  <ion-item color=\"grey\">\n    <ion-thumbnail slot=\"start\">\n      <ion-img\n        [src]=\"\n          documentImages.back_image ||\n          'https://ionicframework.com/docs/img/demos/thumbnail.svg'\n        \"\n        [alt]=\"'documents.back_side' | translate\"\n      ></ion-img>\n    </ion-thumbnail>\n    <ion-label>\n      <ion-row class=\"ion-align-items-center\">\n        <ion-col>\n          <span>{{ 'documents.back_side' | translate }}</span>\n        </ion-col>\n        <ion-col size=\"auto\" class=\"button-container\">\n          <ion-button\n            [style.visibility]=\"\n              documentImages.back_image ? 'visible' : 'hidden'\n            \"\n            (click)=\"removeDocument(DocumentSide.BACK)\"\n            color=\"danger\"\n            fill=\"clear\"\n            shape=\"round\"\n            size=\"large\"\n            [disabled]=\"isDeleteDisabled()\"\n          >\n            <ion-icon name=\"trash\" slot=\"icon-only\"></ion-icon>\n          </ion-button>\n          <ion-button\n            (click)=\"openActionSheet(DocumentSide.BACK)\"\n            shape=\"round\"\n            size=\"large\"\n          >\n            <ion-icon name=\"cloud-upload\" slot=\"icon-only\"></ion-icon>\n          </ion-button>\n        </ion-col>\n      </ion-row>\n    </ion-label>\n  </ion-item>\n</ion-list>\n\n<ion-action-sheet\n  [isOpen]=\"actionSheetState === UIState.OPEN\"\n  [buttons]=\"actionSheetButtons\"\n  (didDismiss)=\"actionSheetState = UIState.CLOSED\"\n></ion-action-sheet>\n"],
  "mappings": "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",
  "names": ["DocumentSide", "UIState", "LoadingState"]
}
