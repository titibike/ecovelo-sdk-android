{
  "version": 3,
  "sources": ["src/app/pages/auth/reset-password/enter-phone/enter-phone.page.ts", "src/app/pages/auth/reset-password/enter-phone/enter-phone.page.html"],
  "sourcesContent": ["import {\n  Component,\n  ViewChild,\n  ElementRef,\n  OnInit,\n  OnDestroy,\n} from '@angular/core'\nimport { CommonModule } from '@angular/common'\nimport {\n  FormControl,\n  FormGroup,\n  FormsModule,\n  ReactiveFormsModule,\n  Validators,\n} from '@angular/forms'\nimport {\n  IonContent,\n  IonInput,\n  IonButton,\n  IonCol,\n  IonText,\n  IonRow,\n  IonItem,\n  LoadingController,\n  ModalController,\n} from '@ionic/angular/standalone'\nimport { TranslateModule, TranslateService } from '@ngx-translate/core'\nimport { HeaderComponent } from 'src/app/components/header/header.component'\nimport { AuthService } from 'src/app/services/external/auth.service'\nimport { Router } from '@angular/router'\nimport { ToastService, ToastType } from 'src/app/services/utils/toast.service'\nimport { CountriesComponent } from 'src/app/components/modals/countries/countries.component'\nimport { Country, CountryService } from 'src/app/services/utils/country.service'\nimport { PhoneUtilsService } from 'src/app/services/utils/phone.service'\nimport { StorageService } from 'src/app/services/utils/storage.service'\nimport { RecaptchaService } from 'src/app/services/external/recaptcha.service'\nimport { resetPassword } from 'aws-amplify/auth'\nimport { environment } from 'src/environments/environment'\nimport { ErrorHandlerService } from 'src/app/services/utils/error-handler.service'\n\n@Component({\n  selector: 'app-enter-phone',\n  templateUrl: './enter-phone.page.html',\n  styleUrls: ['./enter-phone.page.scss'],\n  imports: [\n    IonContent,\n    IonInput,\n    IonCol,\n    IonRow,\n    IonItem,\n    IonButton,\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    TranslateModule,\n    HeaderComponent,\n  ],\n})\nexport class EnterPhonePage implements OnInit, OnDestroy {\n  @ViewChild('phoneInput', { read: ElementRef, static: true })\n  phoneInput!: ElementRef<HTMLInputElement>\n\n  public form: FormGroup\n  public currentCountry: Country | null = null\n\n  constructor(\n    private translateService: TranslateService,\n    private modalController: ModalController,\n    private countryService: CountryService,\n    private router: Router,\n    private loadingCtrl: LoadingController,\n    private toastService: ToastService,\n    private phoneService: PhoneUtilsService,\n    private recaptchaService: RecaptchaService,\n    private errorHandler: ErrorHandlerService\n  ) {\n    this.form = new FormGroup({\n      tel: new FormControl('', Validators.required),\n    })\n  }\n\n  async ngOnInit() {\n    try {\n      const countries = await this.countryService.getCountries()\n      this.currentCountry =\n        countries.find((x: Country) => x.code === 'FR') || null\n\n      if (this.currentCountry) {\n        const placeHolder = await this.phoneService.getPhoneNumberPattern(\n          this.currentCountry\n        )\n        this.phoneInput.nativeElement.placeholder = placeHolder\n      }\n      // Load reCAPTCHA\n      await this.recaptchaService.loadRecaptcha()\n    } catch (err) {\n      console.error('Error fetching countries:', err)\n    }\n  }\n\n  ngOnDestroy() {\n    // Unload reCAPTCHA when the component is destroyed\n    this.recaptchaService.unloadRecaptcha()\n  }\n\n  public async openCountryPage() {\n    const modal = await this.modalController.create({\n      component: CountriesComponent,\n      componentProps: { currentPosition: 'FR' },\n      initialBreakpoint: 0.75,\n      breakpoints: [0, 0.75],\n    })\n\n    modal.onDidDismiss().then(async (data) => {\n      if (data?.data?.selectedCountry) {\n        this.currentCountry = data.data.selectedCountry\n        this.form.controls['tel'].setValue('')\n        if (this.currentCountry) {\n          try {\n            const placeHolder = await this.phoneService.getPhoneNumberPattern(\n              this.currentCountry\n            )\n            this.phoneInput.nativeElement.placeholder = placeHolder\n          } catch {\n            console.warn('No placeholder found')\n            this.phoneInput.nativeElement.placeholder =\n              this.translateService.instant('generic.phone_number')\n          }\n        }\n      }\n    })\n\n    await modal.present()\n  }\n\n  public changePhoneNumber(event: Event) {\n    const inputElement = event.target as HTMLInputElement\n    const inputValue = inputElement.value\n\n    if (this.currentCountry) {\n      const numOutput = this.phoneService.formatPhoneNumber(\n        inputValue,\n        this.currentCountry\n      )\n      inputElement.value = inputValue.startsWith('0')\n        ? inputValue.substring(1)\n        : numOutput\n    }\n  }\n\n  public async sendResetCode() {\n    if (!this.form.controls['tel'].value.trim()) {\n      this.toastService.createWithJustMessage(\n        this.translateService.instant('error.phone_required'),\n        ToastType.Error\n      )\n      return\n    }\n    const loading = await this.loadingCtrl.create({\n      message: this.translateService.instant('generic.please_wait'),\n    })\n    await loading.present()\n\n    const phone =\n      this.currentCountry?.dial_code +\n      this.form.value.tel.replace(/[(),\\-,\\s]/g, '').replace(/^0+/, '')\n\n    try {\n      const token = await this.recaptchaService.executeRecaptcha(\n        'forgotPassword'\n      )\n      if (!token) {\n        throw new Error('Token is null')\n      }\n\n      const result = await resetPassword({\n        username: phone,\n        options: {\n          clientMetadata: {\n            recaptchaToken: token,\n            program: environment.program,\n          },\n        },\n      })\n\n      if (result) {\n        this.toastService.createWithJustMessage(\n          this.translateService.instant('reset_password.code_sent'),\n          ToastType.Success\n        )\n        this.router.navigate(['/confirm-code'], { state: { phone: phone } })\n      }\n    } catch (error) {\n      this.errorHandler.handleError(error)\n    } finally {\n      await loading.dismiss()\n    }\n  }\n}\n", "<app-header></app-header>\n<ion-content class=\"ion-padding\">\n  <form (ngSubmit)=\"sendResetCode()\" [formGroup]=\"form\">\n    <ion-row class=\"ion-justify-content-center\">\n      <ion-col size=\"12\" size-md=\"6\" size-lg=\"4\">\n        <h1>{{ 'reset_password.title' | translate }}</h1>\n      </ion-col>\n    </ion-row>\n    <ion-row class=\"ion-justify-content-center\">\n      <ion-col size=\"12\" size-md=\"6\" size-lg=\"4\">\n        <ion-item class=\"ion-no-padding\">\n          <div\n            class=\"ecl-phone__container\"\n            *ngIf=\"currentCountry\"\n            (click)=\"openCountryPage()\"\n          >\n            <img [src]=\"currentCountry.img\" />\n            <span>{{ currentCountry.dial_code }}</span>\n          </div>\n          <ion-input\n            #phoneInput\n            placeholder=\"{{ 'generic.phone_number' | translate }}\"\n            type=\"tel\"\n            inputmode=\"tel\"\n            name=\"tel\"\n            required\n            formControlName=\"tel\"\n            (ionChange)=\"changePhoneNumber($event)\"\n          ></ion-input>\n        </ion-item>\n      </ion-col>\n    </ion-row>\n    <ion-row class=\"ion-justify-content-center\">\n      <ion-col size=\"12\" size-md=\"6\" size-lg=\"4\">\n        <ion-button\n          type=\"submit\"\n          expand=\"block\"\n          shape=\"round\"\n          [disabled]=\"form.invalid\"\n          class=\"ion-margin-top ecl-btn--shadow\"\n        >\n          {{ 'reset_password.send_code' | translate }}\n        </ion-button>\n      </ion-col>\n    </ion-row>\n  </form>\n</ion-content>\n"],
  "mappings": "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",
  "names": []
}
