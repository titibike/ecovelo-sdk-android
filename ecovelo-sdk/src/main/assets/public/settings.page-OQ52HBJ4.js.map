{
  "version": 3,
  "sources": ["src/app/pages/account/settings/settings.page.ts", "src/app/pages/account/settings/settings.page.html"],
  "sourcesContent": ["import { Component, effect, ViewChild } from '@angular/core'\nimport { CommonModule } from '@angular/common'\nimport { FormsModule } from '@angular/forms'\nimport {\n  IonContent,\n  IonList,\n  IonItem,\n  IonLabel,\n  IonToggle,\n  IonNote,\n  AlertController,\n  IonSkeletonText,\n  LoadingController,\n  IonRow,\n  IonCol,\n} from '@ionic/angular/standalone'\nimport { HeaderComponent } from 'src/app/components/header/header.component'\nimport {\n  AccountService,\n  cyclistState,\n} from 'src/app/services/api-wrappers/account.service'\nimport { Router, RouterLink } from '@angular/router'\nimport { FcmService } from 'src/app/services/external/fcm.service'\nimport { Capacitor } from '@capacitor/core'\nimport { TranslateModule, TranslateService } from '@ngx-translate/core'\nimport { fetchUserAttributes } from 'aws-amplify/auth'\nimport { PushNotifications } from '@capacitor/push-notifications'\nimport {\n  AndroidSettings,\n  IOSSettings,\n  NativeSettings,\n} from 'capacitor-native-settings'\nimport { App } from '@capacitor/app'\nimport { ErrorHandlerService } from 'src/app/services/utils/error-handler.service'\n\n@Component({\n  selector: 'app-settings',\n  templateUrl: './settings.page.html',\n  styleUrls: ['./settings.page.scss'],\n  imports: [\n    IonContent,\n    IonList,\n    IonItem,\n    IonLabel,\n    IonToggle,\n    IonNote,\n    CommonModule,\n    FormsModule,\n    HeaderComponent,\n    RouterLink,\n    IonSkeletonText,\n    IonRow,\n    IonCol,\n    TranslateModule,\n  ],\n})\nexport class SettingsPage {\n  @ViewChild('notificationToggle') notificationToggle!: IonToggle\n  cyclistState: cyclistState\n  userAuthMethod: 'classic' | 'external' = 'classic'\n  constructor(\n    private accountService: AccountService,\n    private router: Router,\n    private alertController: AlertController,\n    private loadingController: LoadingController,\n    private fcmService: FcmService,\n    private translate: TranslateService,\n    private errorHandler: ErrorHandlerService\n  ) {\n    effect(() => {\n      this.cyclistState = this.accountService.cyclistState()\n      if (this.cyclistState.state === 'unknown') {\n        this.accountService.loadCyclist()\n      }\n    })\n    if (Capacitor.isNativePlatform()) {\n      App.addListener('resume', () => {\n        this.checkPermission()\n      })\n      PushNotifications.checkPermissions().then(async (permission) => {\n        if (permission.receive === 'granted') {\n          this.updateToggleState(true)\n        } else {\n          this.updateToggleState(false)\n        }\n      })\n    }\n\n    fetchUserAttributes()\n      .then((attributes) => {\n        if (\n          attributes.sub?.includes('google') ||\n          attributes.sub?.includes('apple')\n        ) {\n          this.userAuthMethod = 'external'\n        } else {\n          this.userAuthMethod = 'classic'\n        }\n      })\n      .catch((err) => {\n        this.errorHandler.handleError(err)\n      })\n  }\n\n  private updateToggleState(state: boolean) {\n    if (this.notificationToggle) {\n      this.notificationToggle.checked = state\n    }\n  }\n\n  async onPushNotificationToggle(event: any) {\n    if (event.detail.checked) {\n      await PushNotifications.requestPermissions().then(async (permission) => {\n        if (permission.receive === 'granted') {\n          await this.fcmService.registerPush()\n          this.updateToggleState(true)\n        } else {\n          const alert = await this.alertController.create({\n            header: this.translate.instant('push_notifications.accept_header'),\n            message: this.translate.instant(\n              'push_notifications.accept_message'\n            ),\n            buttons: [\n              {\n                text: this.translate.instant('generic.cancel'),\n                role: 'cancel',\n                handler: () => {\n                  this.updateToggleState(false)\n                },\n              },\n              {\n                text: this.translate.instant('push_notifications.accept_cta'),\n                role: 'confirm',\n                handler: async () => {\n                  await NativeSettings.open({\n                    optionAndroid: AndroidSettings.ApplicationDetails,\n                    optionIOS: IOSSettings.App,\n                  })\n                },\n              },\n            ],\n          })\n          await alert.present()\n        }\n      })\n    } else {\n      const alert = await this.alertController.create({\n        header: this.translate.instant('push_notifications.deny_header'),\n        message: this.translate.instant('push_notifications.deny_message'),\n        buttons: [\n          {\n            text: this.translate.instant('generic.cancel'),\n            role: 'cancel',\n            handler: () => {\n              this.updateToggleState(true)\n            },\n          },\n          {\n            text: this.translate.instant('push_notifications.deny_cta'),\n            role: 'confirm',\n            handler: async () => {\n              await NativeSettings.open({\n                optionAndroid: AndroidSettings.ApplicationDetails,\n                optionIOS: IOSSettings.App,\n              })\n            },\n          },\n        ],\n      })\n      await alert.present()\n    }\n  }\n\n  async deleteAccount() {\n    const alert = await this.alertController.create({\n      header: this.translate.instant('account.deletion.header'),\n      message: this.translate.instant('account.deletion.message'),\n      buttons: [\n        {\n          text: this.translate.instant('generic.cancel'),\n          role: 'cancel',\n        },\n        {\n          text: this.translate.instant('account.deletion.confirm'),\n          cssClass: 'text-danger',\n          role: 'confirm',\n          handler: async () => {\n            const loading = await this.loadingController.create({\n              message: this.translate.instant('account.deletion.loading'),\n            })\n            await loading.present()\n            if (Capacitor.isNativePlatform()) {\n              await this.fcmService.unRegisterPush()\n            }\n            try {\n              await this.accountService.deleteAccount()\n              await loading.dismiss()\n              this.router.navigate(['/account'], { replaceUrl: true })\n            } catch (err) {\n              this.errorHandler.handleError(err)\n              loading.dismiss()\n            }\n          },\n        },\n      ],\n    })\n    await alert.present()\n  }\n\n  isNative() {\n    return Capacitor.isNativePlatform()\n  }\n\n  async checkPermission() {\n    const permission = await PushNotifications.checkPermissions()\n    if (permission.receive === 'granted') {\n      await this.fcmService.registerPush()\n      this.updateToggleState(true)\n    } else {\n      this.fcmService.unRegisterPush()\n      this.updateToggleState(false)\n    }\n  }\n}\n", "<app-header [defaultHref]=\"'/account'\"></app-header>\n<ion-content class=\"ion-padding\">\n  <ion-row class=\"ion-justify-content-center\">\n    <ion-col size=\"12\" size-md=\"8\" size-lg=\"6\">\n      <h1 class=\"ion-margin\">{{ 'settings.title' | translate }}</h1>\n      @if(cyclistState && cyclistState.state !== 'unknown' && cyclistState.state\n      !== 'error') {\n      <ion-list [inset]=\"true\" mode=\"ios\" lines=\"full\">\n        <ion-item\n          color=\"grey\"\n          button\n          detail=\"true\"\n          [routerLink]=\"'/account/change-password'\"\n          *ngIf=\"userAuthMethod === 'classic'\"\n          [disabled]=\"cyclistState.state === 'deletion_requested'\"\n        >\n          <ion-label>{{ 'settings.change_password' | translate }}</ion-label>\n        </ion-item>\n        <ion-item color=\"grey\" button detail=\"true\" [routerLink]=\"'infos'\">\n          <ion-label>{{ 'settings.infos.title' | translate }}</ion-label>\n        </ion-item>\n        <ion-item color=\"grey\" button detail=\"true\" [routerLink]=\"'cgu'\">\n          <ion-label>{{ 'settings.terms_of_service' | translate }}</ion-label>\n        </ion-item>\n        <ion-item color=\"grey\" *ngIf=\"isNative()\">\n          <ion-toggle\n            #notificationToggle\n            (ionChange)=\"onPushNotificationToggle($event)\"\n          >\n            <ion-label\n              >{{ 'settings.notifications.title' | translate }}</ion-label\n            >\n            <ion-note color=\"medium\"\n              >{{ 'settings.notifications.can_disable' | translate }}</ion-note\n            >\n          </ion-toggle>\n        </ion-item>\n        <ion-item\n          color=\"grey\"\n          button\n          detail=\"true\"\n          [disabled]=\"cyclistState.state === 'deletion_requested'\"\n          (click)=\"deleteAccount()\"\n        >\n          <ion-label color=\"danger\"\n            >{{ 'settings.delete_account' | translate }}</ion-label\n          >\n        </ion-item>\n      </ion-list>\n      } @else {\n      <ion-list lines=\"none\">\n        <ion-item>\n          <ion-skeleton-text\n            animated\n            style=\"width: 100%; height: 50px; margin-top: 10px\"\n          ></ion-skeleton-text>\n        </ion-item>\n        <ion-item>\n          <ion-skeleton-text\n            animated\n            style=\"width: 100%; height: 50px; margin-top: 10px\"\n          ></ion-skeleton-text>\n        </ion-item>\n        <ion-item>\n          <ion-skeleton-text\n            animated\n            style=\"width: 100%; height: 50px; margin-top: 10px\"\n          ></ion-skeleton-text>\n        </ion-item>\n        <ion-item>\n          <ion-skeleton-text\n            animated\n            style=\"width: 100%; height: 50px; margin-top: 10px\"\n          ></ion-skeleton-text>\n        </ion-item>\n      </ion-list>\n      }\n    </ion-col>\n  </ion-row>\n</ion-content>\n"],
  "mappings": "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",
  "names": []
}
