{
  "version": 3,
  "sources": ["src/app/pages/supporting-documents/supporting-documents.page.ts", "src/app/pages/supporting-documents/supporting-documents.page.html"],
  "sourcesContent": ["import { Component } from '@angular/core'\nimport { Router } from '@angular/router'\nimport {\n  AbonnementWrapperService,\n  CreateAbonnementParams,\n} from 'src/app/services/api-wrappers/abonnement.service'\nimport { ToastService, ToastType } from 'src/app/services/utils/toast.service'\nimport { TranslateModule, TranslateService } from '@ngx-translate/core'\nimport { HeaderComponent } from 'src/app/components/header/header.component'\nimport {\n  IonContent,\n  IonRow,\n  IonCol,\n  IonButton,\n  LoadingController,\n} from '@ionic/angular/standalone'\nimport { CommonModule } from '@angular/common'\nimport { FormsModule } from '@angular/forms'\nimport { CreateAbonnementRequestSupportingDocumentsInner } from 'src/api-cyclist'\nimport { SubscriptionProcessService } from 'src/app/services/utils/subscription-process.service'\nimport { firstValueFrom } from 'rxjs'\nimport {\n  DocumentUploaderComponent,\n  DocumentImage,\n} from 'src/app/components/document-uploader/document-uploader.component'\n\n@Component({\n  selector: 'app-supporting-documents',\n  templateUrl: './supporting-documents.page.html',\n  styleUrls: ['./supporting-documents.page.scss'],\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonContent,\n    IonRow,\n    IonCol,\n    IonButton,\n    TranslateModule,\n    HeaderComponent,\n    DocumentUploaderComponent,\n  ],\n})\nexport class SupportingDocumentsPage {\n  requiredDocuments: string[] = []\n  documentImages: { [key: string]: DocumentImage } = {}\n  next: string | null = null\n\n  constructor(\n    private AbonnementWrapperService: AbonnementWrapperService,\n    private router: Router,\n    private toastService: ToastService,\n    private translate: TranslateService,\n    private loadingCtrl: LoadingController,\n    private subscriptionProcess: SubscriptionProcessService\n  ) {}\n\n  async ionViewWillEnter() {\n    const hasForfaitSelected =\n      await this.subscriptionProcess.hasForfaitSelected()\n    if (hasForfaitSelected) {\n      await this.subscriptionProcess.updateStep('documents')\n      const process = await firstValueFrom(\n        this.subscriptionProcess.getCurrentProcess()\n      )\n\n      if (\n        process?.forfait?.supporting_documents &&\n        process.forfait?.supporting_documents.length > 0\n      ) {\n        this.requiredDocuments = process.forfait.supporting_documents\n      }\n    }\n\n    const queryParams = new URLSearchParams(window.location.search)\n    this.next = queryParams.get('next')\n  }\n\n  onDocumentImagesChange(documentName: string, images: DocumentImage) {\n    this.documentImages[documentName] = images\n  }\n\n  async submitDocuments() {\n    const loading = await this.loadingCtrl.create({\n      message: this.translate.instant('subscription.creation.loading'),\n    })\n    await loading.present()\n\n    // Add supporting documents to payload if any\n    if (this.requiredDocuments.length > 0) {\n      const supportingDocuments = Object.entries(this.documentImages).map(\n        ([name, images]) =>\n          ({\n            name,\n            front_image: images.front_image,\n            back_image: images.back_image,\n          } as CreateAbonnementRequestSupportingDocumentsInner)\n      )\n      await this.subscriptionProcess.updateSupportingDocuments(\n        supportingDocuments\n      )\n    }\n\n    if (this.next) {\n      await this.router.navigate([this.next])\n      await loading.dismiss()\n    } else {\n      const payload =\n        await this.subscriptionProcess.getCreateAbonnementPayload()\n      if (!payload) {\n        this.toastService.createWithJustMessage(\n          this.translate.instant('error.generic'),\n          ToastType.Error\n        )\n        await loading.dismiss()\n        return\n      }\n\n      this.AbonnementWrapperService.createAbonnement(payload).then(async () => {\n        await loading.dismiss()\n      })\n    }\n  }\n  isComplete(): boolean {\n    return (\n      this.requiredDocuments.length === 0 ||\n      this.requiredDocuments.every(\n        (doc) => this.documentImages[doc]?.front_image\n      )\n    )\n  }\n}\n", "<app-header [title]=\"'documents.title' | translate\"></app-header>\n\n<ion-content [fullscreen]=\"true\">\n  <ion-row class=\"ion-padding-horizontal\">\n    <ion-col>\n      <h2>{{ 'documents.subtitle' | translate }}</h2>\n      <p>{{ 'documents.description' | translate }}</p>\n    </ion-col>\n  </ion-row>\n\n  <ion-row class=\"ion-padding-horizontal\">\n    <ion-col>\n      <div *ngFor=\"let doc of requiredDocuments\">\n        <app-document-uploader\n          [documentName]=\"doc\"\n          [documentImages]=\"documentImages[doc] || {}\"\n          (documentUpdate)=\"onDocumentImagesChange(doc, $event)\"\n        ></app-document-uploader>\n      </div>\n    </ion-col>\n  </ion-row>\n\n  <ion-row class=\"ion-padding\">\n    <ion-col>\n      <ion-button\n        expand=\"block\"\n        (click)=\"submitDocuments()\"\n        [disabled]=\"!isComplete()\"\n      >\n        {{ 'documents.submit' | translate }}\n      </ion-button>\n    </ion-col>\n  </ion-row>\n</ion-content>\n"],
  "mappings": "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",
  "names": ["AbonnementWrapperService"]
}
